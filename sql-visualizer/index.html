<!DOCTYPE html>
<!--

   Copyright 2015 John Francis Mukulu <john.f.mukulu@gmail.com>

   This program is free software; you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation; either version 2 of the License, or
   (at your option) any later version.

   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with this program; if not, write to the Free Software
   Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
   MA 02110-1301, USA.


-->
<html manifest="sql-visualizer.appcache" ng-app="eventCapture">
    <head>
        <title>SQL Visualizer</title>

        <meta name="description" content="DHIS2">
        <meta name="keywords" content="DHIS 2">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/jQuery/jquery.min.js"></script>
        <link type="text/css" rel="stylesheet" href="../../../dhis-web-commons/javascripts/jQuery/ui/css/redmond/jquery-ui.css">

        <link href="scripts/DataTables/media/css/jquery.dataTables.css" rel="stylesheet" />
        <link href="scripts/angular-datatables/src/plugins/bootstrap/datatables.bootstrap.css" rel="stylesheet" />
        <!--<script type="text/javascript" src="scripts/controllers.js"></script>        -->

        <!-- Menu scripts -->
        <link type="text/css" rel="stylesheet" href="../../../dhis-web-commons/font-awesome/css/font-awesome.min.css"/>
        <link type="text/css" rel="stylesheet" media="screen" href="../../../dhis-web-commons/css/widgets.css"/>
        <link type="text/css" rel="stylesheet" media="screen" href="../../../dhis-web-commons/css/menu.css">

        <!--<link type="text/css" rel="stylesheet" href="styles/style.css">-->
        <link type="text/css" rel="stylesheet" href="styles/bootstrap.css">
        <link type="text/css" rel="stylesheet" href="styles/bootstrap-theme.css">
        <link type="text/css" rel="stylesheet" href="styles/sb-admin-2.css">

    </head>

    <body>
        <d2-header-bar></d2-header-bar>

        <div style="padding-top:50px;">
            <div class="col-lg-13">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h4>View Visualizer</h4>
                    </div>
                    <div class="panel-body">
                        <p>Select Views for Analysis : <select id="csv"  data-placeholder="Choose view from the list"><option></select> &nbsp; &nbsp; <span id="doc"></span></p>
                        <div id="output" style="margin: 10px;">

                            <div class="row">
                                <div class="col-lg-3 col-md-6">
                                    <div class="panel panel-primary">
                                        <div class="panel-heading">
                                            <div class="row">
                                                <div class="col-xs-3">
                                                    <i class="fa fa-table fa-5x"></i>
                                                </div>
                                                <div class="col-xs-9 text-right">
                                                    <div class="huge">PivotTable</div>
                                                </div>
                                            </div>
                                        </div>
                                        <a href="">
                                            <div class="panel-footer">
                                                <span class="pull-left">Experience the full potiential of pivot tables on SQL views like never before</span>
                                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                                                <div class="clearfix"></div>
                                            </div>
                                        </a>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="panel panel-green">
                                        <div class="panel-heading">
                                            <div class="row">
                                                <div class="col-xs-3">
                                                    <i class="fa fa-bar-chart-o fa-5x"></i>
                                                </div>
                                                <div class="col-xs-9 text-right">
                                                    <div class="huge">Charts</div>
                                                </div>
                                            </div>
                                        </div>
                                        <a href="">
                                            <div class="panel-footer">
                                                <span class="pull-left">Unleash chart visualization right out of your sqlviews</span>
                                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                                                <div class="clearfix"></div>
                                            </div>
                                        </a>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="panel panel-yellow">
                                        <div class="panel-heading">
                                            <div class="row">
                                                <div class="col-xs-3">
                                                    <i class="fa fa-filter fa-5x"></i>
                                                </div>
                                                <div class="col-xs-9 text-right">
                                                    <div class="huge">Filter&amp;Group</div>
                                                </div>
                                            </div>
                                        </div>
                                        <a href="">
                                            <div class="panel-footer">
                                                <span class="pull-left">Filter through pile of data from sql view with ability to group and arrange data by criterias</span>
                                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                                                <div class="clearfix"></div>
                                            </div>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="panel-footer">
                        Copyright Â© 2015 John Francis Mukulu &lt;john.f.mukulu@gmail.com&gt;
                    </div>
                </div>
            </div>
        </div>

        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/jQuery/ui/jquery-ui.min.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/jQuery/jquery.plugin.min.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/moment/moment-with-langs.min.js"></script>

        <script type="text/javascript" src="../../../dhis-web-commons/bootstrap/js/bootstrap.min.js"></script>

        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/underscore.min.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/dhis2/dhis2.util.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/commons.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/commons.ajax.js"></script>

        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/jQuery/calendars/jquery.calendars.min.js"></script>

        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/angular/angular.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/angular/angular-resource.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/angular/angular-route.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/angular/angular-cookies.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/angular/angular-animate.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/angular/ui-bootstrap-tpls-0.10.0-draggable-modal.js"></script>


        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/lists.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/periodType.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/date.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/json2.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/validationRules.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/dhis2/dhis2.array.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/dhis2/dhis2.select.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/dhis2/dhis2.comparator.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/dhis2/dhis2.availability.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/dhis2/dhis2.trigger.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/dhis2/dhis2.sharing.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/dhis2/dhis2.validation.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/dhis2/dhis2.storage.ss.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/dhis2/dhis2.storage.ls.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/dhis2/dhis2.storage.idb.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/dhis2/dhis2.storage.memory.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/dhis2/dhis2.storage.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/dhis2/dhis2.contextmenu.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/dhis2/dhis2.appcache.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/ouwt/ouwt.js"></script>
        <script type="text/javascript" src="scripts/event-capture.js"></script>

        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/angular/plugins/angularLocalStorage.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/angular/plugins/angular-translate.min.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/angular/plugins/dhis2/directives.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/angular/plugins/dhis2/filters.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/angular/plugins/dhis2/services.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/angular/plugins/dhis2/controllers.js"></script>

        <script src="scripts/DataTables/media/js/jquery.dataTables.js"></script>
        <script src="scripts/angular-datatables/dist/angular-datatables.min.js"></script>
        <script src="scripts/angular-datatables/src/plugins/bootstrap/angular-datatables.bootstrap.colvis.js"></script>
        <script src="scripts/angular-datatables/src/plugins/bootstrap/angular-datatables.bootstrap.options.js"></script>
        <script src="scripts/angular-datatables/src/plugins/bootstrap/angular-datatables.bootstrap.tabletools.js"></script>
        <script src="scripts/angular-datatables/src/plugins/bootstrap/angular-datatables.bootstrap.js"></script>
        <script src="scripts/angular-material/angular-animate.js"></script>
        <script src="scripts/angular-aria.js"></script>
        <script src="scripts/angular-material/angular-messages.min.js"></script>
        <script src="scripts/angular-ui-date/src/date.js"></script>
        <script type="text/javascript" src="scripts/app.js"></script>
        <script type="text/javascript" src="scripts/services.js"></script>
        <script type="text/javascript" src="scripts/directives.js"></script>
        <!--<script type="text/javascript" src="scripts/controllers.js"></script>        -->
        <script type="text/javascript" src="scripts/controller.js"></script>
        <script type="text/javascript" src="scripts/notes-controller.js"></script>
        <script type="text/javascript" src="scripts/filters.js"></script>

        <!-- Menu scripts -->
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/dhis2/dhis2.translate.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/dhis2/dhis2.menu.js"></script>
        <script type="text/javascript" src="../../../dhis-web-commons/javascripts/dhis2/dhis2.menu.ui.js"></script>


        <script>
            window.dhis2 = window.dhis2 || {};
            dhis2.settings = dhis2.settings || {};
           // dhis2.settings.baseUrl = '../../..';
                        dhis2.settings.baseUrl = '';
        </script>


        <!-- external libs from cdnjs -->

        <link rel="stylesheet" type="text/css" href="styles/c3.min.css">
        <link rel="stylesheet" type="text/css" href="styles/chosen.min.css">
        <script type="text/javascript" src="scripts/d3.min.js"></script>
        <script type="text/javascript" src="scripts/jquery.ui.touch-punch.min.js"></script>
        <script type="text/javascript" src="scripts/jquery.csv-0.71.min.js"></script>
        <script type="text/javascript" src="scripts/chosen.jquery.js"></script>
        <script type="text/javascript" src="scripts/c3.min.js"></script>

        <!-- PivotTable.js libs from ../dist -->
        <link rel="stylesheet" type="text/css" href="styles/pivot.css">
        <script type="text/javascript" src="scripts/pivot.js"></script>
        <script type="text/javascript" src="scripts/d3_renderers.js"></script>
        <script type="text/javascript" src="scripts/c3_renderers.js"></script>
        <script type="text/javascript" src="scripts/export_renderers.js"></script>

        <style type="text/css">
            body {font-family: Verdana;}
            .node {
                border: solid 1px white;
                font: 10px sans-serif;
                line-height: 12px;
                overflow: hidden;
                position: absolute;
                text-indent: 2px;
            }
            .c3-line, .c3-focused {stroke-width: 3px !important;}
            .c3-bar {stroke: white !important; stroke-width: 1;}
            .c3 text { font-size: 12px; color: grey;}
            .tick line {stroke: white;}
            .c3-axis path {stroke: grey;}
        </style>

        <script type="text/javascript">
            $(function(){
                $.get("/api/sqlViews.json?paging=false&fields=href,name", function(sqlViewList){
                    var pkg = $("<optgroup>", {label: ""});
                    var csvlist_arr =sqlViewList.sqlViews;
                    for(var i in csvlist_arr)
                    {
                        var dataset = csvlist_arr[i];
                        if(dataset.name != pkg.attr("label"))
                        {
                            pkg = $("<optgroup>", {label: dataset.name}).appendTo($("#csv"));
                        }
                        pkg.append($("<option>", {value: dataset.href}).text(dataset.name));
                    }
                    $("#csv").chosen();
                    $("#csv").bind("change", function(event){
                        $("#output").empty().text("Loading...")
                        var val = $(this).val();
                        $.get(val+'/data.csv', function(csvtext){

                            var input = $.csv.toArrays(csvtext);
                            input[0][0] = "Row";
                            var renderers = $.extend(
                                    $.pivotUtilities.renderers,
                                    $.pivotUtilities.c3_renderers,
                                    $.pivotUtilities.d3_renderers,
                                    $.pivotUtilities.export_renderers
                            );

                            $("#output").pivotUI(input, {renderers: renderers}, true);
                        });
                    });
                });
            });
        </script>

    </body>
</html>
